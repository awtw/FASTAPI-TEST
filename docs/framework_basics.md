# æ¡†æ¶åŸºç¡€è¯´æ˜æ–‡æ¡£

## ğŸ¤” ä½ çš„ç–‘é—®è§£ç­”

### å…³äº AI Agent çš„é—®é¢˜

**ä½ çš„è§‚å¯Ÿæ˜¯æ­£ç¡®çš„ï¼** è¿™ä¸ªé¡¹ç›®**ç›®å‰å¹¶ä¸æ˜¯ä¸€ä¸ª AI Agent é¡¹ç›®**ï¼Œå®ƒæ˜¯ä¸€ä¸ª**æ ‡å‡† FastAPI åç«¯æ¨¡æ¿**ã€‚

å¦‚æœå½“åˆè¯´è¿™æ˜¯ AI Agent å¼€å‘ï¼Œå¯èƒ½æœ‰ä»¥ä¸‹å‡ ç§æƒ…å†µï¼š
1. **è®¡åˆ’ä¸­ä½†æœªå®ç°** - å¯èƒ½æ˜¯è®¡åˆ’è¦åœ¨è¿™ä¸ªåŸºç¡€ä¸Šæ·»åŠ  AI Agent åŠŸèƒ½
2. **è¯¯è§£** - å¯èƒ½æ˜¯ç†è§£ä¸Šçš„åå·®
3. **æœªæ¥æ‰©å±•æ–¹å‘** - è¿™ä¸ªæ¨¡æ¿å¯ä»¥ä½œä¸º AI Agent åç«¯çš„åŸºç¡€æ¶æ„

---

## ğŸ“š è¿™ä¸ªæ¡†æ¶çš„çœŸå®åŸºç¡€

### æ ¸å¿ƒå®šä½
è¿™æ˜¯ä¸€ä¸ª**ç”Ÿäº§çº§åˆ«çš„ FastAPI RESTful API åç«¯æ¨¡æ¿**ï¼Œä¸“æ³¨äºï¼š
- âœ… æ„å»º Web API æœåŠ¡
- âœ… ç”¨æˆ·è®¤è¯å’Œæƒé™ç®¡ç†
- âœ… æ•°æ®åº“æ“ä½œå’Œæ–‡ä»¶å­˜å‚¨
- âœ… å¾®æœåŠ¡æ¶æ„åŸºç¡€

### æŠ€æœ¯æ ˆåŸºç¡€

#### 1. **FastAPI æ¡†æ¶** (Web æœåŠ¡å±‚)
```
FastAPI â†’ ç°ä»£çš„ Python Web æ¡†æ¶
â”œâ”€â”€ å¼‚æ­¥å¤„ç† (async/await)
â”œâ”€â”€ è‡ªåŠ¨ API æ–‡æ¡£ç”Ÿæˆ (Swagger/ReDoc)
â”œâ”€â”€ ç±»å‹æç¤ºå’ŒéªŒè¯ (Pydantic)
â””â”€â”€ é«˜æ€§èƒ½ (åŸºäº Starlette å’Œ Pydantic)
```

**ç”¨é€”**ï¼šå¤„ç† HTTP è¯·æ±‚ï¼Œæä¾› RESTful API æ¥å£

#### 2. **SQLAlchemy ORM** (æ•°æ®è®¿é—®å±‚)
```
SQLAlchemy â†’ æ•°æ®åº“ ORM æ¡†æ¶
â”œâ”€â”€ æ¨¡å‹å®šä¹‰ (Models)
â”œâ”€â”€ æ•°æ®åº“ä¼šè¯ç®¡ç† (Session)
â””â”€â”€ æŸ¥è¯¢æ„å»ºå™¨
```

**ç”¨é€”**ï¼šç®¡ç†æ•°æ®åº“æ“ä½œï¼Œé¿å…ç›´æ¥å†™ SQL

#### 3. **MySQL** (æ•°æ®å­˜å‚¨å±‚)
```
MySQL â†’ å…³ç³»å‹æ•°æ®åº“
â”œâ”€â”€ æŒä¹…åŒ–å­˜å‚¨æ•°æ®
â”œâ”€â”€ äº‹åŠ¡æ”¯æŒ
â””â”€â”€ å…³è”æŸ¥è¯¢
```

**ç”¨é€”**ï¼šå­˜å‚¨ç”¨æˆ·ã€è´¦æˆ·ã€æ–‡ä»¶ç­‰ä¸šåŠ¡æ•°æ®

#### 4. **Redis** (ç¼“å­˜å±‚)
```
Redis â†’ å†…å­˜æ•°æ®åº“
â”œâ”€â”€ ç¼“å­˜çƒ­ç‚¹æ•°æ®
â”œâ”€â”€ ä¼šè¯å­˜å‚¨
â””â”€â”€ æå‡æ€§èƒ½
```

**ç”¨é€”**ï¼šåŠ é€Ÿæ•°æ®è®¿é—®ï¼Œå­˜å‚¨ä¸´æ—¶æ•°æ®

#### 5. **MinIO/S3** (å¯¹è±¡å­˜å‚¨å±‚)
```
MinIO/S3 â†’ å¯¹è±¡å­˜å‚¨æœåŠ¡
â”œâ”€â”€ æ–‡ä»¶ä¸Šä¼ 
â”œâ”€â”€ æ–‡ä»¶ä¸‹è½½
â””â”€â”€ æ–‡ä»¶ç®¡ç†
```

**ç”¨é€”**ï¼šå­˜å‚¨å›¾ç‰‡ã€æ–‡æ¡£ç­‰æ–‡ä»¶

---

## ğŸ—ï¸ æ¶æ„å±‚æ¬¡

### åˆ†å±‚æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        å®¢æˆ·ç«¯ (æµè§ˆå™¨/ç§»åŠ¨ç«¯)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚ HTTP/HTTPS è¯·æ±‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è·¯ç”±å±‚ (Routers)                        â”‚
â”‚  /public/*  /private/*  /root/*         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä¾èµ–æ³¨å…¥å±‚ (Dependencies)               â”‚
â”‚  â€¢ get_current_user (JWT è®¤è¯)          â”‚
â”‚  â€¢ get_db (æ•°æ®åº“ä¼šè¯)                  â”‚
â”‚  â€¢ get_admin_user (ç®¡ç†å‘˜æƒé™)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä¸šåŠ¡é€»è¾‘å±‚ (CRUD)                        â”‚
â”‚  â€¢ create_user()                        â”‚
â”‚  â€¢ get_user_by_username()               â”‚
â”‚  â€¢ update_user()                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ•°æ®æ¨¡å‹å±‚ (Models)                      â”‚
â”‚  â€¢ User (ç”¨æˆ·è¡¨)                        â”‚
â”‚  â€¢ UserAccount (è´¦æˆ·è¡¨)                  â”‚
â”‚  â€¢ Blob (æ–‡ä»¶è¡¨)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å­˜å‚¨å±‚                                   â”‚
â”‚  â€¢ MySQL (å…³ç³»æ•°æ®)                      â”‚
â”‚  â€¢ Redis (ç¼“å­˜)                         â”‚
â”‚  â€¢ MinIO/S3 (æ–‡ä»¶)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” ä»£ç ç¤ºä¾‹è§£æ

### ç¤ºä¾‹ 1: ç”¨æˆ·ç™»å½•æµç¨‹

```python
# 1. å®¢æˆ·ç«¯å‘èµ·ç™»å½•è¯·æ±‚
POST /public/auth/login
{
  "username": "test-username",
  "password": "test-password"
}

# 2. è·¯ç”±å±‚æ¥æ”¶ (src/routers/public/auth.py)
@router.post("/login")
async def login(
    form_data: OAuth2PasswordRequestForm,
    db: Session = Depends(get_db)  # æ³¨å…¥æ•°æ®åº“ä¼šè¯
):
    # 3. è°ƒç”¨è®¤è¯å‡½æ•°
    user = authenticate_user(db, form_data.username, form_data.password)
    
    # 4. ç”Ÿæˆ JWT Token
    token = create_access_token({"sub": user.account[0].username})
    
    # 5. è¿”å› Token
    return Token(access_token=token, token_type="bearer")
```

**æµç¨‹è¯´æ˜**ï¼š
1. å®¢æˆ·ç«¯å‘é€ç”¨æˆ·åå¯†ç 
2. è·¯ç”±æ¥æ”¶è¯·æ±‚
3. æ•°æ®åº“æŸ¥è¯¢ç”¨æˆ·å¹¶éªŒè¯å¯†ç 
4. ç”Ÿæˆ JWT Token
5. è¿”å› Token ç»™å®¢æˆ·ç«¯

### ç¤ºä¾‹ 2: æ•°æ®åº“æ¨¡å‹å…³ç³»

```python
# src/database/models/sample.py

# ç”¨æˆ·è¡¨
class User(Base):
    __tablename__ = "users"
    id = Column(String(36), primary_key=True)
    name = Column(String(16), unique=True)
    
    # ä¸€å¯¹ä¸€å…³ç³»ï¼šä¸€ä¸ªç”¨æˆ·å¯¹åº”ä¸€ä¸ªè´¦æˆ·
    account = relationship("UserAccount", back_populates="user")
    
    # å¤šå¯¹å¤šå…³ç³»ï¼šä¸€ä¸ªç”¨æˆ·å¯ä»¥æœ‰å¤šä»½æ–‡ä»¶
    blobs = relationship("Blob", secondary=user_blob_association)

# è´¦æˆ·è¡¨
class UserAccount(Base):
    __tablename__ = "accounts"
    id = Column(String(36), primary_key=True)
    username = Column(String(16), unique=True)
    password = Column(String(256))  # åŠ å¯†å­˜å‚¨
    user_id = Column(String(36), ForeignKey("users.id"))
```

**å…³ç³»è¯´æ˜**ï¼š
- `User` â†” `UserAccount`: **ä¸€å¯¹ä¸€** (ä¸€ä¸ªç”¨æˆ·ä¸€ä¸ªè´¦æˆ·)
- `User` â†” `Blob`: **å¤šå¯¹å¤š** (ä¸€ä¸ªç”¨æˆ·å¯ä»¥æœ‰å¤šä¸ªæ–‡ä»¶)

---

## ğŸ¯ è¿™ä¸ªæ¡†æ¶é€‚åˆåšä»€ä¹ˆï¼Ÿ

### âœ… é€‚åˆçš„åœºæ™¯

1. **æ„å»º RESTful API æœåŠ¡**
   - ä¸ºå‰ç«¯åº”ç”¨æä¾›æ•°æ®æ¥å£
   - ä¸ºç§»åŠ¨åº”ç”¨æä¾›åç«¯æœåŠ¡
   - æ„å»ºå¾®æœåŠ¡æ¶æ„ä¸­çš„å•ä¸ªæœåŠ¡

2. **ç”¨æˆ·ç®¡ç†ç³»ç»Ÿ**
   - ç”¨æˆ·æ³¨å†Œã€ç™»å½•ã€è®¤è¯
   - æƒé™ç®¡ç†ï¼ˆæ™®é€šç”¨æˆ·/ç®¡ç†å‘˜/è¶…çº§ç®¡ç†å‘˜ï¼‰
   - ä¸ªäººèµ„æ–™ç®¡ç†

3. **æ–‡ä»¶ç®¡ç†ç³»ç»Ÿ**
   - æ–‡ä»¶ä¸Šä¼ ä¸‹è½½
   - å›¾ç‰‡/æ–‡æ¡£å­˜å‚¨
   - æ–‡ä»¶å…ƒæ•°æ®ç®¡ç†

4. **æ•°æ®ç®¡ç†æœåŠ¡**
   - CRUD æ“ä½œ
   - æ•°æ®æŸ¥è¯¢å’Œç­›é€‰
   - æ•°æ®åº“è¿ç§»ç®¡ç†

### âŒ ä¸é€‚åˆçš„åœºæ™¯ï¼ˆç›®å‰ï¼‰

1. **AI Agent åŠŸèƒ½** âŒ
   - æ²¡æœ‰ LLM é›†æˆ
   - æ²¡æœ‰ LangChain/OpenAI ç­‰ AI åº“
   - æ— æ³•å¤„ç†è‡ªç„¶è¯­è¨€å¯¹è¯

2. **å®æ—¶é€šä¿¡** âŒ
   - æ²¡æœ‰ WebSocket æ”¯æŒ
   - æ²¡æœ‰å®æ—¶æ¨é€åŠŸèƒ½

3. **æœºå™¨å­¦ä¹ æ¨¡å‹** âŒ
   - æ²¡æœ‰ ML æ¡†æ¶é›†æˆ
   - æ²¡æœ‰æ¨¡å‹æ¨ç†æœåŠ¡

---

## ğŸš€ å¦‚æœè¦æ·»åŠ  AI Agent åŠŸèƒ½ï¼Œéœ€è¦ä»€ä¹ˆï¼Ÿ

### éœ€è¦æ·»åŠ çš„ä¾èµ–

```python
# requirements.txt éœ€è¦æ·»åŠ ï¼š
openai              # OpenAI API å®¢æˆ·ç«¯
langchain           # LangChain AI æ¡†æ¶
langchain-openai    # LangChain çš„ OpenAI é›†æˆ
anthropic           # Claude API å®¢æˆ·ç«¯ (å¯é€‰)
```

### éœ€è¦åˆ›å»ºçš„æ–°æ¨¡å—

```
src/
â”œâ”€â”€ ai/                      # AI Agent æ¨¡å—
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ agent.py            # Agent æ ¸å¿ƒé€»è¾‘
â”‚   â”œâ”€â”€ prompts.py          # æç¤ºè¯æ¨¡æ¿
â”‚   â””â”€â”€ tools.py            # Agent å·¥å…·å‡½æ•°
â”‚
â”œâ”€â”€ routers/
â”‚   â””â”€â”€ ai/                 # AI è·¯ç”±
â”‚       â”œâ”€â”€ __init__.py
â”‚       â””â”€â”€ server.py       # /ai/chat, /ai/query ç­‰
```

### ç¤ºä¾‹ï¼šAI Chat æ¥å£

```python
# src/routers/ai/server.py
from fastapi import APIRouter
from langchain_openai import ChatOpenAI
from langchain.agents import AgentExecutor

router = APIRouter()

@router.post("/chat")
async def ai_chat(message: str):
    llm = ChatOpenAI(model="gpt-4")
    response = llm.invoke(message)
    return {"response": response.content}
```

---

## ğŸ“ æ€»ç»“

### å½“å‰æ¡†æ¶çš„æœ¬è´¨
- âœ… **FastAPI RESTful API æ¨¡æ¿**
- âœ… **å®Œæ•´çš„ç”¨æˆ·è®¤è¯ç³»ç»Ÿ**
- âœ… **æ•°æ®åº“æ“ä½œæ¡†æ¶**
- âœ… **æ–‡ä»¶å­˜å‚¨é›†æˆ**
- âŒ **ä¸æ˜¯ AI Agent é¡¹ç›®**ï¼ˆç›®å‰æ²¡æœ‰ AI åŠŸèƒ½ï¼‰

### ä½ å¯ä»¥ç”¨å®ƒæ¥ï¼š
1. å­¦ä¹  FastAPI æ¡†æ¶çš„ä½¿ç”¨
2. å¿«é€Ÿæ­å»ºåç«¯ API æœåŠ¡
3. ä½œä¸ºå…¶ä»–é¡¹ç›®çš„åŸºç¡€æ¨¡æ¿
4. **åœ¨æ­¤åŸºç¡€ä¸Šæ·»åŠ  AI Agent åŠŸèƒ½**ï¼ˆéœ€è¦é¢å¤–å¼€å‘ï¼‰

### ä¸‹ä¸€æ­¥å»ºè®®
å¦‚æœä½ æƒ³åœ¨è¿™ä¸ªæ¡†æ¶ä¸Šæ·»åŠ  AI Agent åŠŸèƒ½ï¼Œæˆ‘å¯ä»¥å¸®ä½ ï¼š
1. æ·»åŠ å¿…è¦çš„ä¾èµ–åŒ…
2. åˆ›å»º AI Agent æ¨¡å—
3. é›†æˆ OpenAI/LangChain
4. åˆ›å»º AI å¯¹è¯æ¥å£

---

**è¿™ä¸ªæ¡†æ¶æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„åŸºç¡€ï¼Œä½†éœ€è¦é¢å¤–å¼€å‘æ‰èƒ½å˜æˆ AI Agent ç³»ç»Ÿï¼** ğŸ¯

