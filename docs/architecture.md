# FastAPI é¡¹ç›®æ¶æ„è¯´æ˜æ–‡æ¡£

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ª**ç”Ÿäº§çº§åˆ«çš„ FastAPI åç«¯æ¨¡æ¿é¡¹ç›®**ï¼Œä¸ºæ„å»ºå¯æ‰©å±•çš„ Web åº”ç”¨æä¾›äº†ä¸€ä¸ªå®Œæ•´çš„å¼€å‘åŸºç¡€ã€‚é¡¹ç›®é‡‡ç”¨ç°ä»£åŒ–çš„ Python æŠ€æœ¯æ ˆï¼Œé›†æˆäº†æ•°æ®åº“ã€ç¼“å­˜ã€å¯¹è±¡å­˜å‚¨ã€è®¤è¯æˆæƒç­‰å®Œæ•´åŠŸèƒ½ã€‚

### é¡¹ç›®æ ¸å¿ƒåŠŸèƒ½

1. **RESTful API å¼€å‘** - åŸºäº FastAPI æ¡†æ¶æ„å»ºé«˜æ€§èƒ½ API
2. **ç”¨æˆ·è®¤è¯ä¸æˆæƒ** - å¤šå±‚æ¬¡æƒé™ç®¡ç†ç³»ç»Ÿï¼ˆå…¬å¼€/ç§æœ‰/ç®¡ç†å‘˜/è¶…çº§ç®¡ç†å‘˜ï¼‰
3. **æ•°æ®åº“ç®¡ç†** - MySQL å…³ç³»å‹æ•°æ®åº“ + Alembic æ•°æ®åº“è¿ç§»å·¥å…·
4. **ç¼“å­˜ç³»ç»Ÿ** - Redis ç”¨äºç¼“å­˜å’Œä¼šè¯ç®¡ç†
5. **æ–‡ä»¶å­˜å‚¨** - MinIO (å¼€å‘) æˆ– AWS S3 (ç”Ÿäº§) å¯¹è±¡å­˜å‚¨
6. **é”™è¯¯ç›‘æ§** - Sentry é›†æˆç”¨äºé”™è¯¯è¿½è¸ªå’Œæ€§èƒ½ç›‘æ§
7. **å®¹å™¨åŒ–éƒ¨ç½²** - Docker + Docker Compose ä¸€é”®å¯åŠ¨æ‰€æœ‰æœåŠ¡
8. **è‡ªåŠ¨æ–‡æ¡£** - Swagger UIã€ReDocã€Stoplight Elements

---

## ğŸ—ï¸ é¡¹ç›®æ¶æ„

### æŠ€æœ¯æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          å®¢æˆ·ç«¯å±‚ (Client)                        â”‚
â”‚                     Web / Mobile / Desktop                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚ HTTP/HTTPS
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        FastAPI åº”ç”¨å±‚ (Port 8000)                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  å…¬å¼€è·¯ç”±    â”‚  â”‚  ç§æœ‰è·¯ç”±    â”‚  â”‚  ç®¡ç†å‘˜è·¯ç”±  â”‚          â”‚
â”‚  â”‚ /public/*   â”‚  â”‚ /private/*  â”‚  â”‚ /root/*     â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                      ä¸­é—´ä»¶å±‚ (Middleware)                 â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚   â”‚
â”‚  â”‚  â”‚  CORS    â”‚  â”‚  JWT è®¤è¯â”‚  â”‚  API Key â”‚              â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                    â”‚                    â”‚
        â–¼                    â–¼                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    MySQL     â”‚    â”‚    Redis     â”‚    â”‚    MinIO     â”‚
â”‚   (Port 3306)â”‚    â”‚   (Port 6379)â”‚    â”‚  (Port 9000) â”‚
â”‚              â”‚    â”‚              â”‚    â”‚              â”‚
â”‚  Â· Users     â”‚    â”‚  Â· ç¼“å­˜      â”‚    â”‚  Â· å¯¹è±¡å­˜å‚¨  â”‚
â”‚  Â· Accounts  â”‚    â”‚  Â· ä¼šè¯      â”‚    â”‚  Â· æ–‡ä»¶ä¸Šä¼   â”‚
â”‚  Â· Blobs     â”‚    â”‚              â”‚    â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                    â”‚                    â”‚
        â”‚                    â”‚                    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚  Docker Network    â”‚
                  â”‚  (shared_network)  â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æœåŠ¡æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       Docker Compose ç¼–æ’å±‚                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   Backend      â”‚  â”‚  MySQL   â”‚  â”‚  Redis   â”‚  â”‚   MinIO    â”‚ â”‚
â”‚  â”‚  (FastAPI)     â”‚  â”‚          â”‚  â”‚          â”‚  â”‚            â”‚ â”‚
â”‚  â”‚  Container     â”‚  â”‚  :3306   â”‚  â”‚  :6379   â”‚  â”‚  :9000/9001â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚           â”‚                                                       â”‚
â”‚           â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  Adminer â”‚                               â”‚
â”‚                       â”‚  :8001   â”‚                               â”‚
â”‚                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â”‚                                                                    â”‚
â”‚  æ‰€æœ‰æœåŠ¡è¿è¡Œåœ¨ shared_network ç½‘ç»œä¸­                              â”‚
â”‚  æ•°æ®æŒä¹…åŒ–åœ¨ ./volume/ ç›®å½•                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç›®å½•ç»“æ„æ¶æ„

```
FastAPI-TEST/
â”œâ”€â”€ ğŸ“ src/                          # åº”ç”¨æºä»£ç 
â”‚   â”œâ”€â”€ ğŸ“ crud/                     # æ•°æ®åº“ CRUD æ“ä½œå±‚
â”‚   â”‚   â”œâ”€â”€ user.py                  # ç”¨æˆ· CRUD æ“ä½œ
â”‚   â”‚   â””â”€â”€ __init__.py
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ database/                 # æ•°æ®åº“é…ç½®å±‚
â”‚   â”‚   â”œâ”€â”€ database.py              # æ•°æ®åº“è¿æ¥æ± é…ç½®
â”‚   â”‚   â”œâ”€â”€ models/                  # SQLAlchemy æ¨¡å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ base.py              # åŸºç¡€æ¨¡å‹å’Œå…³è”è¡¨
â”‚   â”‚   â”‚   â””â”€â”€ sample.py            # ä¸šåŠ¡æ¨¡å‹ (User, UserAccount, Blob)
â”‚   â”‚   â”œâ”€â”€ utils.py                 # æ•°æ®åº“å·¥å…·å‡½æ•°
â”‚   â”‚   â””â”€â”€ __init__.py
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ dependencies/             # FastAPI ä¾èµ–æ³¨å…¥å±‚
â”‚   â”‚   â”œâ”€â”€ auth.py                  # è®¤è¯ä¾èµ– (JWT, API Key)
â”‚   â”‚   â”œâ”€â”€ basic.py                 # åŸºç¡€ä¾èµ– (æ•°æ®åº“ä¼šè¯)
â”‚   â”‚   â””â”€â”€ __init__.py
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ routers/                  # API è·¯ç”±å±‚
â”‚   â”‚   â”œâ”€â”€ db/                      # æ•°æ®åº“ç®¡ç†è·¯ç”±
â”‚   â”‚   â”‚   â””â”€â”€ server.py            # æ•°æ®åº“é‡ç½®ã€Alembic è¿ç§»
â”‚   â”‚   â”œâ”€â”€ private/                 # éœ€è¦è®¤è¯çš„è·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.py              # ç§æœ‰è®¤è¯è·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ user.py              # ç”¨æˆ·ç®¡ç†è·¯ç”±
â”‚   â”‚   â”‚   â””â”€â”€ server.py
â”‚   â”‚   â”œâ”€â”€ public/                  # å…¬å¼€è·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.py              # ç™»å½•æ³¨å†Œè·¯ç”±
â”‚   â”‚   â”‚   â””â”€â”€ server.py
â”‚   â”‚   â”œâ”€â”€ root/                    # ç®¡ç†å‘˜è·¯ç”±
â”‚   â”‚   â”‚   â””â”€â”€ server.py            # Sentry æµ‹è¯•ç­‰ç®¡ç†åŠŸèƒ½
â”‚   â”‚   â”œâ”€â”€ server.py                # è·¯ç”±æ±‡æ€»
â”‚   â”‚   â””â”€â”€ __init__.py
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ schemas/                  # Pydantic æ•°æ®æ¨¡å¼å±‚
â”‚   â”‚   â”œâ”€â”€ base.py                  # åŸºç¡€ Schema
â”‚   â”‚   â”œâ”€â”€ basic.py                 # ä¸šåŠ¡ Schema
â”‚   â”‚   â””â”€â”€ __init__.py
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ utils/                    # å·¥å…·å‡½æ•°å±‚
â”‚   â”‚   â”œâ”€â”€ credentials.py           # JWT & å¯†ç åŠ å¯†
â”‚   â”‚   â”œâ”€â”€ handler.py               # é”™è¯¯å¤„ç†è£…é¥°å™¨
â”‚   â”‚   â”œâ”€â”€ s3.py                    # S3/MinIO æ–‡ä»¶ä¸Šä¼ 
â”‚   â”‚   â”œâ”€â”€ swagger.py               # Swagger UI è‡ªå®šä¹‰
â”‚   â”‚   â”œâ”€â”€ utils.py                 # é€šç”¨å·¥å…·
â”‚   â”‚   â””â”€â”€ __init__.py
â”‚   â”‚
â”‚   â””â”€â”€ server.py                    # FastAPI åº”ç”¨ä¸»å…¥å£
â”‚
â”œâ”€â”€ ğŸ“ alembic/                      # æ•°æ®åº“è¿ç§»
â”‚   â”œâ”€â”€ versions/                    # è¿ç§»ç‰ˆæœ¬æ–‡ä»¶
â”‚   â”œâ”€â”€ env.py                       # Alembic ç¯å¢ƒé…ç½®
â”‚   â””â”€â”€ script.py.mako               # è¿ç§»æ¨¡æ¿
â”‚
â”œâ”€â”€ ğŸ“ mysql-backup/                 # MySQL å¤‡ä»½å·¥å…·
â”‚   â”œâ”€â”€ backup.sh                    # å¤‡ä»½è„šæœ¬
â”‚   â”œâ”€â”€ restore.sh                   # æ¢å¤è„šæœ¬
â”‚   â””â”€â”€ Dockerfile                   # å¤‡ä»½å®¹å™¨é…ç½®
â”‚
â”œâ”€â”€ ğŸ“„ docker-compose.yaml           # æœåŠ¡ç¼–æ’é…ç½®
â”œâ”€â”€ ğŸ“„ Dockerfile                    # åç«¯é•œåƒæ„å»ºæ–‡ä»¶
â”œâ”€â”€ ğŸ“„ requirements.txt              # Python ä¾èµ–
â”œâ”€â”€ ğŸ“„ alembic.ini                   # Alembic é…ç½®
â”œâ”€â”€ ğŸ“„ example.env                   # ç¯å¢ƒå˜é‡æ¨¡æ¿
â””â”€â”€ ğŸ“„ README.md                     # é¡¹ç›®è¯´æ˜æ–‡æ¡£
```

---

## ğŸ› ï¸ æŠ€æœ¯é€‰å‹

### æ ¸å¿ƒæ¡†æ¶

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” | è¯´æ˜ |
|------|------|------|------|
| **Python** | 3.11 | ç¼–ç¨‹è¯­è¨€ | ç°ä»£åŒ– Python ç‰¹æ€§ |
| **FastAPI** | latest | Web æ¡†æ¶ | é«˜æ€§èƒ½ã€å¼‚æ­¥ã€è‡ªåŠ¨æ–‡æ¡£ |
| **Uvicorn** | included | ASGI æœåŠ¡å™¨ | ç”Ÿäº§çº§åˆ« WSGI/ASGI æœåŠ¡å™¨ |
| **SQLAlchemy** | latest | ORM æ¡†æ¶ | æ•°æ®åº“æŠ½è±¡å±‚ |
| **Alembic** | latest | æ•°æ®åº“è¿ç§» | ç‰ˆæœ¬æ§åˆ¶å’Œè¿ç§»ç®¡ç† |

### æ•°æ®åº“ä¸å­˜å‚¨

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” | ç«¯å£ |
|------|------|------|------|
| **MySQL** | 8.3 | å…³ç³»å‹æ•°æ®åº“ | 3306 |
| **Redis** | 7.0 | ç¼“å­˜ä¸ä¼šè¯å­˜å‚¨ | 6379 |
| **MinIO** | latest | å¯¹è±¡å­˜å‚¨ (å¼€å‘) | 9000/9001 |
| **AWS S3** | - | å¯¹è±¡å­˜å‚¨ (ç”Ÿäº§) | - |

### è®¤è¯ä¸å®‰å…¨

| æŠ€æœ¯ | ç”¨é€” |
|------|------|
| **JWT** (python-jose) | ç”¨æˆ·è®¤è¯ä»¤ç‰Œ |
| **bcrypt/argon2** | å¯†ç åŠ å¯† |
| **OAuth2** | è®¤è¯æµç¨‹ |
| **API Keys** | ç®¡ç†å‘˜è®¤è¯ |

### å¼€å‘ä¸è¿ç»´

| æŠ€æœ¯ | ç”¨é€” |
|------|------|
| **Docker** | å®¹å™¨åŒ–éƒ¨ç½² |
| **Docker Compose** | å¤šå®¹å™¨ç¼–æ’ |
| **Sentry** | é”™è¯¯è¿½è¸ªå’Œæ€§èƒ½ç›‘æ§ |
| **Adminer** | æ•°æ®åº“ç®¡ç†ç•Œé¢ |
| **Alembic** | æ•°æ®åº“è¿ç§» |

### API æ–‡æ¡£

| æŠ€æœ¯ | ç½‘å€ |
|------|------|
| **Swagger UI** | `/docs` |
| **ReDoc** | `/redoc` |
| **Stoplight Elements** | `/elements` |

---

## ğŸ”„ æ•°æ®æµæ¶æ„

### 1. ç”¨æˆ·ç™»å½•æµç¨‹

```
ç”¨æˆ·è¯·æ±‚
   â”‚
   â–¼
POST /public/auth/login
   â”‚
   â–¼
authenticate_user()
   â”œâ”€ æŸ¥è¯¢æ•°æ®åº“ (get_user_by_username)
   â”œâ”€ éªŒè¯å¯†ç  (verify_password)
   â””â”€ ç”Ÿæˆ JWT (create_access_token)
   â”‚
   â–¼
è¿”å› Token
```

### 2. è®¤è¯ç”¨æˆ·è®¿é—®æµç¨‹

```
å®¢æˆ·ç«¯è¯·æ±‚
   â”‚
   â–¼
æ·»åŠ  Bearer Token åˆ° Header
   â”‚
   â–¼
get_current_user ä¾èµ–
   â”œâ”€ æå– Token
   â”œâ”€ éªŒè¯ Token (decode_token)
   â”œâ”€ è·å–ç”¨æˆ·å
   â””â”€ æŸ¥è¯¢ç”¨æˆ· (get_user_by_username)
   â”‚
   â–¼
è®¿é—®å—ä¿æŠ¤çš„è·¯ç”± (/private/*)
```

### 3. æ–‡ä»¶ä¸Šä¼ æµç¨‹

```
POST /private/upload (å¸¦æ–‡ä»¶)
   â”‚
   â–¼
ä¾èµ–: get_current_user (éªŒè¯ç™»å½•)
   â”‚
   â–¼
save_upload_files_locally()
   â”œâ”€ è¯»å–æ–‡ä»¶å†…å®¹
   â””â”€ ä¿å­˜ä¸´æ—¶æ–‡ä»¶
   â”‚
   â–¼
upload_local_to_s3()
   â”œâ”€ è¿æ¥ MinIO/S3
   â”œâ”€ ä¸Šä¼ æ–‡ä»¶
   â””â”€ è¿”å› URL
   â”‚
   â–¼
è¿”å›æ–‡ä»¶ URL
```

### 4. æ•°æ®åº“æ“ä½œæµç¨‹

```
API è¯·æ±‚
   â”‚
   â–¼
get_db ä¾èµ–æ³¨å…¥
   â””â”€ åˆ›å»ºæ•°æ®åº“ä¼šè¯
   â”‚
   â–¼
CRUD æ“ä½œ (src/crud/)
   â”œâ”€ æ‰§è¡Œ SQL
   â”œâ”€ æäº¤äº‹åŠ¡
   â””â”€ è¿”å›æ•°æ®
   â”‚
   â–¼
Schema éªŒè¯ (src/schemas/)
   â””â”€ æ ¼å¼åŒ–å“åº”
   â”‚
   â–¼
è¿”å› JSON
```

---

## ğŸ” æƒé™æ¶æ„

### æƒé™å±‚çº§

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     è®¿é—®å±‚çº§ (ç”±ä½åˆ°é«˜)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  1. å…¬å¼€è®¿é—® (Public)                                        â”‚
â”‚     â€¢ è·¯ç”±: /public/*                                        â”‚
â”‚     â€¢ è®¤è¯: æ— éœ€è®¤è¯                                         â”‚
â”‚     â€¢ ç¤ºä¾‹: /public/auth/login                               â”‚
â”‚                                                               â”‚
â”‚  2. ç”¨æˆ·è®¿é—® (Private)                                       â”‚
â”‚     â€¢ è·¯ç”±: /private/*                                       â”‚
â”‚     â€¢ è®¤è¯: JWT Token (Bearer)                              â”‚
â”‚     â€¢ ä¾èµ–: get_current_user                                â”‚
â”‚     â€¢ ç¤ºä¾‹: /private/user/profile                           â”‚
â”‚                                                               â”‚
â”‚  3. ç®¡ç†å‘˜è®¿é—® (Admin)                                       â”‚
â”‚     â€¢ è·¯ç”±: /root/*                                          â”‚
â”‚     â€¢ è®¤è¯: X-ADMIN-TOKEN header                            â”‚
â”‚     â€¢ ä¾èµ–: get_admin_user                                  â”‚
â”‚     â€¢ é»˜è®¤å€¼: admin                                          â”‚
â”‚     â€¢ ç¤ºä¾‹: /root/test-sentry-error                         â”‚
â”‚                                                               â”‚
â”‚  4. è¶…çº§ç®¡ç†å‘˜è®¿é—® (Super Admin)                             â”‚
â”‚     â€¢ è·¯ç”±: /db/*                                            â”‚
â”‚     â€¢ è®¤è¯: X-SUPER-ADMIN-TOKEN header                      â”‚
â”‚     â€¢ ä¾èµ–: get_super_admin_user                            â”‚
â”‚     â€¢ é»˜è®¤å€¼: admin.root                                     â”‚
â”‚     â€¢ ç¤ºä¾‹: /db/renew, /db/alembic                          â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

åŒä¸€è·¯ç”±å¯èƒ½åº”ç”¨å¤šä¸ªä¾èµ–ï¼ˆå¦‚ `/private/*` ä¼šå…ˆéªŒè¯ JWTï¼‰ã€‚

---

## ğŸ“Š æ•°æ®åº“æ¶æ„

### æ•°æ®æ¨¡å‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         users è¡¨                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ id: String(36)           [ä¸»é”®]                           â”‚
â”‚  â€¢ name: String(16)         [å”¯ä¸€ç´¢å¼•]                       â”‚
â”‚  â€¢ created_at: DateTime                                      â”‚
â”‚  â€¢ updated_at: DateTime                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚ 1:1
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        accounts è¡¨                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ id: String(36)           [ä¸»é”®]                           â”‚
â”‚  â€¢ username: String(16)     [å”¯ä¸€ç´¢å¼•]                       â”‚
â”‚  â€¢ password: String(256)                                     â”‚
â”‚  â€¢ user_id: String(36)      [å¤–é”® â†’ users.id]                â”‚
â”‚  â€¢ created_at: DateTime                                      â”‚
â”‚  â€¢ updated_at: DateTime                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         blobs è¡¨                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ id: String(36)           [ä¸»é”®]                           â”‚
â”‚  â€¢ content_type: String(16)                                  â”‚
â”‚  â€¢ filename: String(512)                                     â”‚
â”‚  â€¢ url: String(1024)                                         â”‚
â”‚  â€¢ created_at: DateTime                                      â”‚
â”‚  â€¢ updated_at: DateTime                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚ N:M (å¤šå¯¹å¤š)
                â”‚
                â–¼ user_chatrooms (å…³è”è¡¨)
                â”‚
                â””â”€â–º users
```

### å…³ç³»è¯´æ˜

- **User â†” UserAccount**: ä¸€å¯¹ä¸€å…³ç³»ï¼Œä¸€ä¸ªç”¨æˆ·å¯¹åº”ä¸€ä¸ªè´¦å·
- **User â†” Blob**: å¤šå¯¹å¤šå…³ç³»ï¼Œé€šè¿‡ `user_chatrooms` å…³è”è¡¨
- **ID ç”Ÿæˆ**: ä½¿ç”¨ ULID ç”Ÿæˆå”¯ä¸€ ID (36 å­—ç¬¦)
- **æ—¶é—´æˆ³**: è‡ªåŠ¨è®°å½• `created_at` å’Œ `updated_at`

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

```bash
# ç¡®ä¿å·²å®‰è£…
- Docker Engine 20.10+
- Docker Compose 2.0+
- Git
```

### 2. å…‹éš†é¡¹ç›®

```bash
git clone <repository-url>
cd FASTAPI-TEST
```

### 3. é…ç½®ç¯å¢ƒå˜é‡

```bash
# å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿
cp example.env .env

# å¦‚éœ€ä¿®æ”¹é…ç½®ï¼Œç¼–è¾‘ .env æ–‡ä»¶
# é»˜è®¤é…ç½®å³å¯è¿è¡Œ
```

### 4. å¯åŠ¨æ‰€æœ‰æœåŠ¡

```bash
# æ„å»ºå¹¶å¯åŠ¨æ‰€æœ‰å®¹å™¨
docker-compose up -d

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f
```

### 5. åˆå§‹åŒ–æ•°æ®åº“

```bash
# åˆ›å»ºæ•°æ®åº“è¡¨å¹¶æ’å…¥æµ‹è¯•æ•°æ®
curl -X POST http://localhost:8000/db/renew \
  -H "X-SUPER-ADMIN-TOKEN: admin.root"
```

### 6. è®¿é—®æœåŠ¡

| æœåŠ¡ | ç½‘å€ | è¯´æ˜ |
|------|------|------|
| FastAPI åº”ç”¨ | http://localhost:8000 | ä¸»åº”ç”¨ |
| API æ–‡æ¡£ (Swagger) | http://localhost:8000/docs | äº¤äº’å¼ API æ–‡æ¡£ |
| API æ–‡æ¡£ (ReDoc) | http://localhost:8000/redoc | é™æ€æ–‡æ¡£ |
| API æ–‡æ¡£ (Elements) | http://localhost:8000/elements | ç°ä»£åŒ–æ–‡æ¡£ |
| æ•°æ®åº“ç®¡ç† (Adminer) | http://localhost:8001 | æ•°æ®åº“ GUI |
| MinIO æ§åˆ¶å° | http://localhost:9001 | å¯¹è±¡å­˜å‚¨ç®¡ç† |
| MinIO API | http://localhost:9000 | S3 å…¼å®¹ API |

**é»˜è®¤è´¦å·**:
- MinIO: `admin` / `admin1234`
- Adminer: `admin` / `admin1234`
- æµ‹è¯•ç”¨æˆ·: `test-username` / `test-password`

---

## ğŸ“š å¸¸ç”¨æ“ä½œ

### æ•°æ®åº“æ“ä½œ

```bash
# é‡ç½®æ•°æ®åº“ (åˆ é™¤æ‰€æœ‰è¡¨å¹¶é‡å»º)
curl -X POST http://localhost:8000/db/renew \
  -H "X-SUPER-ADMIN-TOKEN: admin.root"

# æ‰§è¡Œ Alembic è¿ç§»
curl -X POST http://localhost:8000/db/alembic \
  -H "X-SUPER-ADMIN-TOKEN: admin.root"

# æˆ–è€…ç›´æ¥ä½¿ç”¨å‘½ä»¤è¡Œ
docker exec template-backend alembic upgrade head
```

### ç”¨æˆ·ç™»å½•

```bash
# è·å– JWT Token
curl -X POST http://localhost:8000/public/auth/login \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "username=test-username&password=test-password"

# ä½¿ç”¨ Token è®¿é—®å—ä¿æŠ¤è·¯ç”±
curl http://localhost:8000/private/user/profile \
  -H "Authorization: Bearer YOUR_TOKEN_HERE"
```

### æŸ¥çœ‹æ—¥å¿—

```bash
# æŸ¥çœ‹æ‰€æœ‰æœåŠ¡æ—¥å¿—
docker-compose logs -f

# æŸ¥çœ‹ç‰¹å®šæœåŠ¡æ—¥å¿—
docker-compose logs -f backend
docker-compose logs -f mysql

# å®æ—¶ç›‘æ§
docker-compose logs --tail=100 -f
```

### é‡å¯æœåŠ¡

```bash
# é‡å¯æ‰€æœ‰æœåŠ¡
docker-compose restart

# é‡å¯ç‰¹å®šæœåŠ¡
docker-compose restart backend

# é‡æ–°æ„å»ºå¹¶å¯åŠ¨
docker-compose up -d --build
```

---

## ğŸ¯ é¡¹ç›®ç‰¹è‰²

### 1. åˆ†å±‚æ¶æ„æ¸…æ™°
- **è·¯ç”±å±‚** â†’ **ä¾èµ–æ³¨å…¥å±‚** â†’ **CRUD å±‚** â†’ **æ¨¡å‹å±‚**
- èŒè´£åˆ†ç¦»ï¼Œä¾¿äºç»´æŠ¤å’Œæµ‹è¯•

### 2. å®‰å…¨è®¤è¯å®Œæ•´
- JWT ä»¤ç‰Œè®¤è¯
- å¤šå±‚æ¬¡æƒé™æ§åˆ¶
- å¯†ç åŠ å¯†å­˜å‚¨

### 3. å¼€å‘ä½“éªŒä¼˜ç§€
- çƒ­é‡è½½å¼€å‘
- è‡ªåŠ¨ API æ–‡æ¡£
- ç±»å‹æç¤ºæ”¯æŒ
- é”™è¯¯è¿½è¸ª (Sentry)

### 4. ç”Ÿäº§å°±ç»ª
- Docker å®¹å™¨åŒ–
- æ•°æ®åº“è¿æ¥æ± 
- å¥åº·æ£€æŸ¥
- æ•°æ®æŒä¹…åŒ–

### 5. çµæ´»æ‰©å±•
- MinIO (å¼€å‘) / AWS S3 (ç”Ÿäº§) åˆ‡æ¢
- å¯é€‰çš„ Sentry é›†æˆ
- æ”¯æŒæ•°æ®åº“è¿ç§»

---

## ğŸ”§ æ‰©å±•å¼€å‘æŒ‡å—

### æ·»åŠ æ–°çš„æ•°æ®æ¨¡å‹

```python
# 1. åœ¨ src/database/models/sample.py ä¸­æ·»åŠ æ¨¡å‹
class Product(Base):
    __tablename__ = "products"
    id = Column(String(36), primary_key=True)
    name = Column(String(255))
    price = Column(Float)

# 2. åˆ›å»ºè¿ç§»
docker exec template-backend alembic revision --autogenerate -m "Add products table"

# 3. åº”ç”¨è¿ç§»
docker exec template-backend alembic upgrade head
```

### æ·»åŠ æ–°çš„ CRUD æ“ä½œ

```python
# åœ¨ src/crud/product.py
def create_product(db: Session, name: str, price: float):
    product = models.Product(
        id=str(ULID()),
        name=name,
        price=price
    )
    db.add(product)
    db.commit()
    db.refresh(product)
    return product
```

### æ·»åŠ æ–°çš„è·¯ç”±

```python
# åœ¨ src/routers/private/product.py
router = APIRouter()

@router.post("/products")
async def create_product_endpoint(
    product: ProductCreate,
    db: Session = Depends(get_db),
    current_user: User = Depends(get_current_user)
):
    return crud.create_product(db, product.name, product.price)
```

---

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **ç«¯å£è¢«å ç”¨**
   ```bash
   # æŸ¥çœ‹ç«¯å£å ç”¨
   lsof -i :8000
   
   # åœæ­¢å ç”¨è¿›ç¨‹æˆ–ä¿®æ”¹ docker-compose.yaml ä¸­çš„ç«¯å£
   ```

2. **æ•°æ®åº“è¿æ¥å¤±è´¥**
   ```bash
   # æ£€æŸ¥ MySQL å®¹å™¨çŠ¶æ€
   docker-compose ps mysql
   
   # æŸ¥çœ‹ MySQL æ—¥å¿—
   docker-compose logs mysql
   ```

3. **å®¹å™¨æ— æ³•å¯åŠ¨**
   ```bash
   # æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
   docker-compose logs backend
   
   # é‡æ–°æ„å»ºé•œåƒ
   docker-compose up -d --build --force-recreate
   ```

---

## ğŸ“– æ›´å¤šèµ„æº

 - FastAPI å®˜æ–¹æ–‡æ¡£: https://fastapi.tiangolo.com/
 - SQLAlchemy æ–‡æ¡£: https://docs.sqlalchemy.org/
 - Docker Compose æ–‡æ¡£: https://docs.docker.com/compose/
 - Sentry æ–‡æ¡£: https://docs.sentry.io/

---

## ğŸ“ æ€»ç»“

è¿™æ˜¯ä¸€ä¸ªåŠŸèƒ½å®Œæ•´ã€æ¶æ„æ¸…æ™°çš„ FastAPI åç«¯æ¨¡æ¿ï¼Œé€‚åˆï¼š
- âœ… å¿«é€Ÿæ­å»º RESTful API é¡¹ç›®
- âœ… å­¦ä¹ ç°ä»£ Python Web å¼€å‘
- âœ… ä½œä¸ºä¼ä¸šçº§é¡¹ç›®çš„èµ·ç‚¹
- âœ… ç†è§£å¾®æœåŠ¡æ¶æ„è®¾è®¡

é¡¹ç›®é‡‡ç”¨äº†ä¸šç•Œæœ€ä½³å®è·µï¼ŒåŒ…æ‹¬åˆ†å±‚æ¶æ„ã€ä¾èµ–æ³¨å…¥ã€å®¹å™¨åŒ–éƒ¨ç½²ç­‰ï¼Œæ˜¯ä¸€ä¸ªå€¼å¾—å­¦ä¹ å’Œä½¿ç”¨çš„ä¼˜ç§€æ¨¡æ¿ã€‚

